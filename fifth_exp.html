<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Move Image with Phone Tilt (Up-Down & Left-Right)</title>
    <style>
        body {
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        img {
            position: absolute;
            width: 200px; /* Adjust image size */
            height: auto;
            transition: transform 0.1s linear; /* Smooth movement */
        }
        #permission {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px;
            background: white;
            border: 2px solid black;
            font-size: 18px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body>
    <button id="permission">Enable Motion Control</button>
    <img src="https://sburambekova.github.io/AR_first_exp/assets/datasheet.png"
         id="myImage" alt="Image">

         <script>
            document.addEventListener("DOMContentLoaded", function () {
                let img = document.getElementById("myImage");
                let permissionButton = document.getElementById("permission");
                let sensitivity = 10; // Increased sensitivity
                let posX = 0, posY = 0;
        
                // Wait for image to load before calculating boundaries
                img.addEventListener('load', function() {
                    updateBoundaries(); // Initial boundary calculation
                });
        
                function updateBoundaries() {
                    let imgWidth = img.clientWidth;
                    let imgHeight = img.clientHeight;
                    let minX = -((imgWidth - window.innerWidth) / 2);
                    let maxX = (imgWidth - window.innerWidth) / 2;
                    let minY = -((imgHeight - window.innerHeight) / 2);
                    let maxY = (imgHeight - window.innerHeight) / 2;
        
                    // Reset position if boundaries change (e.g., orientation change)
                    posX = Math.max(minX, Math.min(posX, maxX));
                    posY = Math.max(minY, Math.min(posY, maxY));
                    
                    return { minX, maxX, minY, maxY };
                }
        
                function startMotion() {
                    let { minX, maxX, minY, maxY } = updateBoundaries();
        
                    if (window.DeviceOrientationEvent) {
                        window.addEventListener("deviceorientation", handleOrientation);
                    } else {
                        alert("Your device does not support motion sensors.");
                    }
                }
        
                function handleOrientation(event) {
                    let { minX, maxX, minY, maxY } = updateBoundaries();
                    
                    // Use negative gamma for more natural left/right movement
                    let gamma = (event.gamma || 0) * -1; 
                    let beta = (event.beta || 0);
                    
                    // Apply movement with sensitivity
                    posX += gamma * (sensitivity * 0.1);
                    posY += beta * (sensitivity * 0.1);
        
                    // Clamp values to boundaries
                    posX = Math.max(minX, Math.min(posX, maxX));
                    posY = Math.max(minY, Math.min(posY, maxY));
        
                    // Apply transformation
                    img.style.transform = `translate(${posX}px, ${posY}px)`;
                }
        
                // Handle iOS permission
                if (typeof DeviceOrientationEvent.requestPermission === "function") {
                    permissionButton.style.display = "block";
                    permissionButton.addEventListener("click", async () => {
                        try {
                            const permission = await DeviceOrientationEvent.requestPermission();
                            if (permission === "granted") {
                                permissionButton.style.display = "none";
                                startMotion();
                            }
                        } catch (error) {
                            alert("Permission required for motion control");
                        }
                    });
                } else {
                    // Start directly on non-iOS devices
                    startMotion();
                }
        
                // Update boundaries on window resize
                window.addEventListener('resize', updateBoundaries);
            });
        </script>
</body>
</html>